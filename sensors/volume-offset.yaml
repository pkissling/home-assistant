---

- platform: template
  sensors:

    volume_kitchen:
      value_template: >
        {% set volume = states('sensor.volume_kitchen_without_offset') | float + states('input_number.volume_offset') | int / 100 | float %}
        {{ 0 if volume < 0 else volume }}
    volume_kitchen_without_offset:
      value_template: >
        {% set default_volume = 0.1 %}
        {% if is_state('media_player.kitchen', 'off') or is_state('media_player.kitchen', 'idle') %}
          {{ default_volume }}
        {% elif is_state_attr('media_player.kitchen', 'media_content_id', 'https://dispatcher.rndfnk.com/br/puls/live/aac/low') %}
          {{ default_volume + 0.15 }}
        {% elif is_state_attr('media_player.kitchen', 'app_name', 'Spotify') %}
          {{ default_volume + 0.2 }}
        {% elif 'google_translate' in state_attr('media_player.kitchen', 'media_content_id') %}
          {{ default_volume + 0.25 }}
        {% elif is_state_attr('media_player.kitchen', 'app_name', 'Google News') %}
          {{ default_volume + 0.15 }}
        {% else %}
          {{ default_volume }}
        {% endif %}

    volume_bathroom:
      value_template: >
        {% set volume = states('sensor.volume_bathroom_without_offset') | float + states('input_number.volume_offset') | int / 100 | float %}
        {{ 0 if volume < 0 else volume }}
    volume_bathroom_without_offset:
      value_template: >
        {% set default_volume = 0.1 %}
        {% if is_state('media_player.bathroom', 'off') or is_state('media_player.bathroom', 'idle') %}
          {{ default_volume }}
        {% elif is_state_attr('media_player.bathroom', 'media_content_id', 'https://dispatcher.rndfnk.com/br/puls/live/aac/low') %}
          {{ default_volume + 0.15 }}
        {% elif is_state_attr('media_player.bathroom', 'app_name', 'Spotify') %}
          {{ default_volume + 0.2 }}
        {% elif 'google_translate' in state_attr('media_player.bathroom', 'media_content_id') %}
          {{ default_volume + 0.25 }}
        {% elif is_state_attr('media_player.bathroom', 'app_name', 'Google News') %}
          {{ default_volume + 0.15 }}
        {% else %}
          {{ default_volume }}
        {% endif %}

    volume_bedroom:
      value_template: >
        {% set volume = states('sensor.volume_bedroom_without_offset') | float + states('input_number.volume_offset') | int / 100 | float %}
        {{ 0 if volume < 0 else volume }}
    volume_bedroom_without_offset:
      value_template: >
        {% set default_volume = 0.1 %}
        {% if is_state('media_player.bedroom', 'off') or is_state('media_player.bedroom', 'idle') %}
          {{ default_volume }}
        {% elif is_state_attr('media_player.bedroom', 'media_content_id', 'https://dispatcher.rndfnk.com/br/puls/live/aac/low') %}
          {{ default_volume + 0.15 }}
        {% elif is_state_attr('media_player.bedroom', 'app_name', 'Spotify') %}
          {{ default_volume + 0.2 }}
        {% elif 'google_translate' in state_attr('media_player.bedroom', 'media_content_id') %}
          {{ default_volume + 0.25 }}
        {% elif is_state_attr('media_player.bedroom', 'app_name', 'Google News') %}
          {{ default_volume + 0.15 }}
        {% else %}
          {{ default_volume }}
        {% endif %}

    volume_living_room:
      value_template: >
        {% set volume = states('sensor.volume_living_room_without_offset') | float + states('input_number.volume_offset') | int / 100 | float %}
        {{ 0 if volume < 0 else volume }}
    volume_living_room_without_offset:
      value_template: >
        {% set default_volume = 0.1 %}
        {% if is_state('media_player.living_room', 'off') or is_state('media_player.living_room', 'idle') %}
          {{ default_volume }}
        {% elif is_state_attr('media_player.living_room', 'media_content_id', 'https://dispatcher.rndfnk.com/br/puls/live/aac/low') %}
          {{ default_volume + 0.15 }}
        {% elif is_state_attr('media_player.living_room', 'app_name', 'Spotify') %}
          {{ default_volume + 0.2 }}
        {% elif 'google_translate' in state_attr('media_player.living_room', 'media_content_id') %}
          {{ default_volume + 0.25 }}
        {% elif is_state_attr('media_player.living_room', 'app_name', 'Google News') %}
          {{ default_volume + 0.15 }}
        {% else %}
          {{ default_volume }}
        {% endif %}

    volume_study:
      value_template: >
        {% set volume = states('sensor.volume_study_without_offset') | float + states('input_number.volume_offset') | int / 100 | float %}
        {{ 0 if volume < 0 else volume }}
    volume_study_without_offset:
      value_template: >
        {% set default_volume = 0.1 %}
        {% if is_state('input_boolean.guest_mode', 'on') %}
          0
        {% elif is_state('media_player.study', 'off') or is_state('media_player.study', 'idle') %}
          {{ default_volume }}
        {% elif is_state_attr('media_player.study', 'media_content_id', 'https://dispatcher.rndfnk.com/br/puls/live/aac/low') %}
          {{ default_volume + 0.15 }}
        {% elif is_state_attr('media_player.study', 'app_name', 'Spotify') %}
          {{ default_volume + 0.2 }}
        {% elif 'google_translate' in state_attr('media_player.study', 'media_content_id') %}
          {{ default_volume + 0.25 }}
        {% elif is_state_attr('media_player.study', 'app_name', 'Google News') %}
          {{ default_volume + 0.15 }}
        {% else %}
          {{ default_volume }}
        {% endif %}

    volume_chromecast:
      value_template: >
        {% set volume = states('sensor.volume_chromecast_without_offset') | float + states('input_number.volume_offset') | int / 100 | float %}
        {{ 0 if volume < 0 else volume }}
    volume_chromecast_without_offset:
      value_template: >
        {% set default_volume = 0.5 %}
        {% if is_state('media_player.chromecast', 'off') or is_state('media_player.chromecast', 'idle') %}
          {{ default_volume }}
        {% elif is_state_attr('media_player.chromecast', 'media_content_id', 'https://dispatcher.rndfnk.com/br/puls/live/aac/low') %}
          {{ default_volume + 0.2 }}
        {% elif is_state_attr('media_player.chromecast', 'app_name', 'Spotify') %}
          {{ default_volume + 0.2 }}
        {% elif 'google_translate' in state_attr('media_player.chromecast', 'media_content_id') %}
          {{ default_volume + 0.2 }}
        {% elif is_state_attr('media_player.chromecast', 'app_name', 'Google News') %}
          {{ default_volume + 0.2 }}
        {% else %}
          {{ default_volume }}
        {% endif %}
